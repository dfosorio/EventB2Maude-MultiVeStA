# EventB2Maude-MultiVeStA

The EventB2Maude tool, originally presented in the following [github repository](https://github.com/carlosolarte/EventB2Maude), allows to translate probabilistic Event-B models to probabilistic rewrite theories in Maude, that are verifiable in PVeStA, based on the theory presented [here](https://arxiv.org/abs/2206.05813). This repository contains a modified version of the previously mentioned tool, that allows the verification of the translated models with the [MultiVeStA](https://github.com/andrea-vandin/MultiVeStA) tool. Furthermore, a [bachelors thesis document](https://github.com/dfosorio/Thesis/blob/main/Document/main.pdf) can be consulted for more detailed information on the theoretical ad technical aspects behind the tool.

## Table of Contents
- [Project Structure](#projectstructure)
- [Prerequisites & Setup](#installation)
- [Usage](#usage)

## Project Structure
The project is divided in the following folders:
- The [parser](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/parser) folder, contains the python files used for the translation of the probabilistic Event-B models to probabilistic Maude. The [EventBLexer.py](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/EventBLexer.py), [EventBListener.py](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/EventBListener.py) and [EventBParser.py](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/EventBParser.py) where generated by the [ANTLR](https://www.antlr.org/) program, and are used by the [B2Maude.py](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/B2Maude.py) file, which contains all the logic for the compilation and translation of the probabilistic Event-B models to probabilistic Maude. The defined grammar for the compilation of the Event-B models is defined in the [EventB.g4](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/EventB.g4) file.



- As its name suggests it, the [MultiVeStA](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA) folder contains the MultiVeStA tool. The original download link of this program can be found [here](https://github.com/andrea-vandin/MultiVeStA/wiki/Integration-with-PMaude-specification). The structure of the MultiVeStA folder tool is the following:
  - The [Maude-3.0+yices2-linux](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA/Maude-3.0%2Byices2-linux) contains the Maude program (Maude executable and related other related files)
  - The [m-theory](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA/m-theory) folder contains the necessary Maude theory for the encoded probabilistic Event-B models. For more information, refer to the third chapter of the [bachelors thesis document](https://github.com/dfosorio/Thesis/blob/main/Document/main.pdf).
  - The [apmaude.maude](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/MultiVeStA/apmaude.maude) file, which contains the necessary maude theory to exceute the MultiVeStA simulations. For more information, refer to the fourth chapter of the [bachelors thesis document](https://github.com/dfosorio/Thesis/blob/main/Document/main.pdf).
  - The [multivesta.jar](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/MultiVeStA/multivesta.jar) executable, used to run the simulations.

- The [CS1_DiceProgram](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/CS1_DiceProgram), [CS2_BRetrans5](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/CS2_BRetrans5) and [CS3_PNL](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/CS3_PNL) are some case study folders for the tool, with the following structure:
  - A **Models** folder that contains the probabilistic Event-b models (files with .b extension) and the resulting probabilistic Maude models (files with .maude extension) after translating them with the parser.
  - A **MultiQuatTEx** folder with the MultiQuatTEx files that specify the quantitative temporal logic formulas that were evaluated in the simulations.
  - A **Results** folder with the results returned by MultiVeStA after running the simulations with the models and MultiQuatTEx formulas.
  - A **runMultivestaLinux64.sh** file used to execute the simulations using MultiVeStA, that specify the simulation parameters. 
    
## Prerequisites & Setup
The project was developed and tested using Ubuntu 22.04 LTS, but it should also work with other Linux distros. To use the tool, simply download or clone the project. No installation is requiered.

## Usage
The general workflow when using tool is the following:

#### 1. Definition of the Evnt-B probabilistic model
Create the probabilistic Event-B model in a file with .b extesion, using the grammar defined in [EventB.g4](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/EventB.g4) file. You can use as an example case study models specified in the **Models** folders.

#### 2. Translation from probabilistic Event-B to probabilistic Maude.
To translate a probabilistic Event-B model, for example **"model.b"**, use the [B2Maude.py](https://github.com/dfosorio/EventB2Maude-MultiVeStA/blob/main/parser/B2Maude.py) file using the following command:

```console
python3 path/to/file/B2Maude.py --input path/to/file/model.b --output model.maude 
```
the **--input** argument recieves the path to the model that is going to be translated, and **--output** recieves the name of the resulting maude specification file, in this case **"model.maude**.

#### 3. Definition of the MultiQuatTEx formula
Create the MultiQuatTEx formula that is going to be evaluated using MultiVeStA and the previously defined model. The file extension of this file should be .multiquatex, for example, **formula.multiquatex**.

#### 4. Definition of sh file to run simulations 
To define the file that will be used to run the simuations, create a shell file with the following command:

```sh
java -jar multivesta.jar client -sd vesta.pmaude.NewAPMaudeState -m model.maude -o '-mc ./Maude-3.0+yices2-linux/maude-Yices2.linux64' -f formula.multiquatex -l 1 -osws ONESTEP -bs 100 -vp true -verboseServers false -a 0.01 -d1 delta -ir 0.2 
```
where:
  - The -m parameter recieves the file name of the model file, in this case **model.maude**.
  - The -f parameter recieves the file name of the formula file, in this case **formula.maude**
  - The -bs parameter recieves a number that represents the batch size for the simulations. In this case the number is **100**.
  - The -a parameter recieves a number that represents the alpha parameter for the simulations. In this case the number is **0.01**.
  - The -d parameter recieves a number that represents the delta parameter for the simulations. In this case the number is **0.02**.

#### 5. Running the simulations
To run the simulations using MultiVeStA, it is necessary to include inside the [MultiVeStA](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA) folder the model file defined in step 2, the multiquatex formula file defined in step 3, and the shell file defined in step 4. After that, simply exceute the shell file inside the [MultiVeStA](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA) folder:

```console
path/to/MultiVeStA/folder/runMultivestaLinux64.sh 
```
in this case, the name of the shell file is **runMultivestaLinux64.sh**. After that, the results of the simulation will be saved in a newly created folder named **MultiVeStA_OUTPUT** inside the [MultiVeStA](https://github.com/dfosorio/EventB2Maude-MultiVeStA/tree/main/MultiVeStA) folder.
